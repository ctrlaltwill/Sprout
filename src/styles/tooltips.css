/* ============================================================================
   TOOLTIPS — Default, modal, dark-mode, settings, browser-table tooltips.
   Positioned absolutely relative to parent, similar to popovers.
   ========================================================================== */

/* ---- Base tooltip ---- */

[data-tooltip] {
  position: relative;
  overflow: visible !important;
}

[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  padding: 6px 10px;
  border-radius: var(--radius-m);
  font-size: var(--sprout-font-2xs) !important;
  font-weight: 400 !important;
  line-height: 1.4 !important;
  max-width: min(300px, var(--sprout-tooltip-max-width, 300px));
  width: max-content;
  white-space: normal;
  overflow-wrap: anywhere;
  text-align: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.15s ease;
  transition-delay: 0s;
  z-index: 950 !important;
  /* Theme-aware: inverted surface/text — !important to beat any theme overrides */
  background-color: var(--foreground) !important;
  color: var(--background) !important;
  border: var(--sprout-border-width) solid var(--sprout-border-color) !important;
  -webkit-font-smoothing: antialiased !important;
}

[data-tooltip]:hover::after {
  opacity: 1;
  transition-delay: 0.8s;
}

/* Lift the hovered element above any parent stacking context (e.g. sticky header) */
[data-tooltip]:hover {
  z-index: 949 !important;
}

/* Escalate ancestor stacking context within .sprout so the tooltip
   ::after is never trapped behind sibling layers.
   Exclude scroll containers to prevent glitchy behavior. */
.sprout *:has([data-tooltip]:hover):not(.sprout-browser-table-wrap) {
  z-index: 949 !important;
}

/* Only allow overflow:visible on table cells and rows, not on scroll containers */
.sprout tr:has([data-tooltip]:hover),
.sprout td:has([data-tooltip]:hover) {
  overflow: visible !important;
}

[data-tooltip]::before {
  content: "";
  display: none !important;
}

/* ---- Shared tooltip surface (for programmatic tooltips) ---- */

.sprout .sprout-data-tooltip-surface {
  padding: 6px 10px;
  border-radius: var(--radius-m);
  font-size: var(--sprout-font-2xs);
  font-weight: 400;
  line-height: 1.4;
  background-color: var(--foreground);
  color: var(--background);
  border: var(--sprout-border-width) solid var(--sprout-border-color);
  box-shadow: none;
  -webkit-font-smoothing: antialiased;
}

/* ---- Tooltip positioning classes ---- */

/* Bottom (default) — centred horizontally, just below the parent */
[data-tooltip]::after,
[data-tooltip-position="bottom"]::after {
  top: calc(100% + 6px);
  left: 50%;
  transform: translateX(calc(-50% + var(--sprout-tooltip-shift-x, 0px)));
}

/* Top — centred horizontally, just above the parent */
[data-tooltip-position="top"]::after {
  bottom: calc(100% + 6px);
  top: auto;
  left: 50%;
  transform: translateX(calc(-50% + var(--sprout-tooltip-shift-x, 0px)));
}

/* Left — centred vertically, just left of the parent */
[data-tooltip-position="left"]::after {
  right: calc(100% + 6px);
  left: auto;
  top: 50%;
  transform: translateY(-50%);
}

/* Right — centred vertically, just right of the parent */
[data-tooltip-position="right"]::after {
  left: calc(100% + 6px);
  top: 50%;
  transform: translateY(-50%);
}

/* ---- Dark mode tooltip contrast ---- */

.theme-dark .sprout [data-tooltip]::after {
  background-color: var(--foreground) !important;
  color: var(--background) !important;
  border: var(--sprout-border-width) solid var(--sprout-border-color) !important;
}

/* ---- Settings tooltips: allow overflow and ensure visibility ---- */

.sprout-settings .setting-item,
.sprout-settings .setting-item-control,
.sprout-settings .setting-item-info {
  overflow: visible !important;
}

.sprout-settings .setting-item {
  margin-bottom: 0px !important;
}

/* ---- Runtime measuring element (used by src/core/tooltip-positioner.ts) ---- */

.sprout-tooltip-measure {
  position: fixed;
  left: -99999px;
  top: -99999px;
  visibility: hidden;
  pointer-events: none;
  z-index: -1;

  padding: 6px 10px;
  border-radius: var(--radius-m);
  font-size: var(--sprout-font-2xs);
  font-weight: 400;
  line-height: 1.4;
  width: max-content;
  white-space: normal;
  overflow-wrap: anywhere;
  text-align: center;

  background-color: var(--foreground);
  color: var(--background);
  border: var(--sprout-border-width) solid var(--sprout-border-color);
  -webkit-font-smoothing: antialiased;
}
